<!DOCTYPE html>
<html lang="en-IN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>MY CASE CONVERTER</title>
<style>
body {
    font-family: "Segoe UI", sans-serif;
    background-color: #f6f8fa;
    margin: 0;
    padding: 20px;
    color: #222;
}
h1 {
    text-align: center;
    margin-bottom: 20px;
}
textarea {
    width: 100%;
    border-radius: 10px;
    border: 1px solid #ccc;
    padding: 12px;
    font-size: 16px;
    resize: vertical;
    box-sizing: border-box;
    outline: none;
    margin-bottom: 10px;
    cursor: pointer;
    transition: 0.2s;
}
textarea.selected {
    border: 2px solid #0078d7;
    background-color: #e1f0ff;
}
button {
    margin-top: 10px;
    background-color: #0078d7;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    transition: 0.2s;
    margin-right: 10px;
}
button:hover {
    background-color: #005fa3;
}
.stats {
    margin-top: 10px;
    font-size: 14px;
}
.case-buttons {
    margin-top: 10px;
}
.case-buttons button {
    margin-bottom: 5px;
}
.section {
    margin-top: 30px;
}
</style>
</head>
<body>
<h1> MY CASE CONVERTER </h1>

<div class="section">
<h2>Analyze & Frame Sentence</h2>
<textarea id="textInput" rows="6" placeholder="Enter your sentence in English/Hinglish/Hindi..."></textarea>
<button onclick="analyzeAndFrame()">Analyze & Frame</button>

<h3>Reframed Sentence(s):</h3>
<div id="alternativesContainer"></div>

<div class="stats" id="stats"></div>

<div class="case-buttons">
    <button onclick="convertCase('uppercase')">UPPERCASE</button>
    <button onclick="convertCase('lowercase')">lowercase</button>
    <button onclick="convertCase('titlecase')">Title Case</button>
    <button onclick="convertCase('sentencecase')">Sentence case</button>
</div>

<button onclick="copyText()">Copy Selected</button>
<button onclick="downloadText()">Download Selected</button>
</div>

<script>
let selectedTextarea = null;

// ================== System Prompt ==================
const systemPrompt = `
You are a friendly, emotionally aware writing assistant.
Tasks:
1. Detect the language of the input: "English (India)", "Hinglish", or "Hindi".
   - Works even for very short input (1–3 words).
2. Rephrase the input into 3 natural, human-like sentences in the **same language as the input**:
   - Hindi input → Hindi
   - Hinglish input → Hinglish
   - English input → English (India) (Indian spelling and vocabulary)
3. Preserve tone and meaning.
4. Respond ONLY in JSON with this format:
{
  "language":"<detected language>",
  "alternatives":["alt1","alt2","alt3"]
}
5. Do NOT include explanations, extra text, or markdown.
`;

// ================= Analyze & Frame =================
async function analyzeAndFrame() {
    const text = document.getElementById('textInput').value.trim();
    const container = document.getElementById('alternativesContainer');
    const statsDiv = document.getElementById('stats');
    container.innerHTML = "Analysing and reframing your sentence...";
    statsDiv.innerText = '';
    selectedTextarea = null;

    if (!text) {
        container.innerHTML = "Kindly enter a sentence or phrase first.";
        return;
    }

    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer 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`
            },
            body: JSON.stringify({
                model: "gpt-4o-mini",
                messages: [
                    { role: "system", content: systemPrompt },
                    { role: "user", content: text }
                ],
                temperature: 0.6,
                max_tokens: 400
            })
        });

        const data = await response.json();
        let raw = data.choices?.[0]?.message?.content?.trim() || "";

        // Try parse JSON
        let parsed = null;
        try { parsed = JSON.parse(raw); } catch(e) {
            const match = raw.match(/\{[\s\S]*\}/);
            if(match) parsed = JSON.parse(match[0]);
        }

        // Fallback if parse fails
        if(!parsed || !parsed.language || !Array.isArray(parsed.alternatives)){
            let langGuess = /[\u0900-\u097F]/.test(text) ? "Hindi" : /[a-zA-Z]/.test(text) ? "English (India)" : "Hinglish";
            parsed = { language: langGuess, alternatives: Array(3).fill(text) };
        }

        // Ensure exactly 3 alternatives
        const alts = parsed.alternatives.slice(0,3);
        while(alts.length < 3) alts.push(text);

        // Display alternatives directly
        container.innerHTML = '';
        alts.forEach((alt, idx) => {
            const ta = document.createElement('textarea');
            ta.rows = 3;
            ta.value = alt.replace(/^["'“”‘’]+|["'“”‘’]+$/g,'').trim();
            ta.id = `alternative_${idx}`;
            ta.onclick = () => selectTextarea(ta);
            container.appendChild(ta);
        });

        updateStats(parsed.language);

    } catch(error) {
        console.error(error);
        container.innerHTML = "Error: " + (error.message || error);
    }
}

// ================= Common Functions =================
function selectTextarea(ta) {
    if (selectedTextarea) selectedTextarea.classList.remove('selected');
    selectedTextarea = ta;
    selectedTextarea.classList.add('selected');
}

function convertCase(caseType) {
    if (!selectedTextarea) {
        alert("Please select a sentence first!");
        return;
    }
    let text = selectedTextarea.value;
    switch(caseType) {
        case "uppercase": selectedTextarea.value = text.toUpperCase(); break;
        case "lowercase": selectedTextarea.value = text.toLowerCase(); break;
        case "titlecase": selectedTextarea.value = text.replace(/\w\S*/g, txt => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()); break;
        case "sentencecase": selectedTextarea.value = text.charAt(0).toUpperCase() + text.slice(1).toLowerCase(); break;
    }
}

function copyText() {
    if (!selectedTextarea) {
        alert("Please select a sentence first!");
        return;
    }
    navigator.clipboard.writeText(selectedTextarea.value)
        .then(() => alert("Text copied to clipboard!"))
        .catch(err => alert("Failed to copy text: " + err));
}

function downloadText() {
    if (!selectedTextarea) {
        alert("Please select a sentence first!");
        return;
    }
    const blob = new Blob([selectedTextarea.value], {type: 'text/plain'});
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'sentence.txt';
    link.click();
}

function updateStats(detectedLanguage) {
    const container = document.getElementById('alternativesContainer');
    const statsDiv = document.getElementById('stats');
    if (!container.children.length) return;

    const target = selectedTextarea || container.children[0];
    const text = target.value || "";
    const words = text.trim().split(/\s+/).filter(Boolean).length;
    const chars = text.length;
    const sentences = text.split(/[.!?]+/).filter(Boolean).length || 1;
    const avgWordsPerSentence = words / sentences;
    const avgSyllablesPerWord = text.replace(/[^a-zA-Z ]/g,'').split(/\s+/).reduce((acc, w) => {
        const s = w.toLowerCase().replace(/e\b/,'').match(/[aeiouy]{1,2}/g);
        return acc + (s ? s.length : 1);
    }, 0) / (words || 1);
    const readability = 206.835 - 1.015 * avgWordsPerSentence - 84.6 * avgSyllablesPerWord;

    const langText = detectedLanguage ? `Detected language: ${detectedLanguage} | ` : '';
    statsDiv.innerText = `${langText}Words: ${words} | Characters: ${chars} | Readability Score: ${readability.toFixed(1)}`;
}
</script>
</body>
</html>
